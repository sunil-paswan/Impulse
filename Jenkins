pipeline {
    agent {label 'windows_node'}
   // agent any
    environment {
        registry = "891633128047.dkr.ecr.ap-south-1.amazonaws.com/project"
       // ecr_pass = "eyJwYXlsb2FkIjoiRzJNRFFLWk5CK0JCWS9UbFByWjNnZFhYVWd5Zk9qUzY5R25lSU4vdFdOSUNGMmx1UGE0NlUrYXJqalVkcnZYVUNqWHJaT0NqZDg2NGpIL0VxNlY4RDllc01idW1HajZjbXhDK3VubjdlVkpRUWY2b0VEaFp0WVBmQVBJeFpyK3JDQWI5dFVWYTFYRHdvUG4wYzBLTldLdkRLZSs4anAvRUlBcUlWNkF2YS9HNUhqc0lQUngybXN4WVpySVgwTlQwQzNPcjlsNGlyNXBZbkxlakJBVXpTc0daOGd1K0syd0ZNaFBSTTVCZkt0cDBPNTdCWWprRnQrMm5HQlpmTVFHZFp4R2wzcGphSERobE5TZG5xN2M0RkMweG9CRm12M3BVbXEwZXFVaDc0aEVhaFpRS0FxMUgrc2YyTmxQbEZpSUdsQW1URU1vMlRhcVpHTklOdHZlWFVpZUlPNHFwdS9RbzdpL0J1bWxlejZsU2szZFZHbnU3TjRDZ21MeDQ2aGhKallGdjdadE5pdkRTY2lsVDE2QUpYMnRYNmdYMWZQZ3NNSVBHcnJXK3VCYXlTYmFZS3h1VFh5Z0tRaFVPd2RpVFVJZFExWkFIZVc1S0xJRTMzZGZmb1V3YjRkUXNRMWZ0K2tiRHAvczBvbWc1Z2RHd1poaGxjYkpuUHBNN1M2YkU1Z0IrOFJJOFR6VVY4U1ZodS9hT1VtSUk2RTVjZ3ZhMHoyL1lnb0hDRldjdyt0dVY0R1JkVGx3cS9UbTMrTmY2ZnQ5eHFkVXZjSWQxV2htSW5mUTZrVmZkV08xQVYybEtMbXRMSmVqcTlFcm51U0Qxb1diNk1zMVVQaVNadU1zL3c3bEd6b0pOZFBEdWlRNHlHMjNRNGhrREJ4WTlTZmRsRWM5MlFjR3Q0QzdSdHBhNDNaWWhZZlBaZWUyWllOY2xCdnhYZytyUkgwZ2pMRWg4cTZJemJoRVVjOSszQ2NUTEJSLzlWVWJ1MkNkQUcvTUxtLzJjK3czQjJiTkRBbXdjQTh0L095WUlhUElTQndCRlJwRVh6eTVCYWNvNFRzZ1F4bW1TTEh5WGFUakx3eXpaTFY5RE9CUHlYVWdHaWFDQmN6VHBUNk5SUE9UQm9sTnNHbElDN00rcTdCSU12bVUzTzFkY3lsZ1BZeVV3NFhVODJ3OXB5SzRQQWNQU2hYcUVsemdWUkEvYlFja2l2b25GektyS3JjdXVaYU5KZUFhdEpRSjBZMmtFZ2UrN005T1AxOXJzVzNvU1IyYjBzcHhxQUhSRk9nZTViQmF4Sm9VMTUzaHBGempyMVczVzhWQjJlZmh5ODZVZ1pyYit1d1QzMG1zbjYvMm1mMWx6ajlMQTNmaUpPQjBiaE02U1d5ZEp5NGR1N25GWG1lWG9MUDEzb2NJejdESlhGUWxITGpVRzR1aSsrdTY4dDVSNHR3OXhDVXlybXF4dnhCUlUrTjdlM0E9PSIsImRhdGFrZXkiOiJBUUlCQUhpSFdhWVRuUlVXQ2Jueis3THZNRytBUHZUSHpIbEJVUTlGcUVtVjI2QmR3d0U3S2NmU3Nid0FqOFlVbndjTFo1Q09BQUFBZmpCOEJna3Foa2lHOXcwQkJ3YWdiekJ0QWdFQU1HZ0dDU3FHU0liM0RRRUhBVEFlQmdsZ2hrZ0JaUU1FQVM0d0VRUU1kemE1QkJkcDgrZ0V2YWUyQWdFUWdEdERHTWRUaWllK0RGUnlwcFFyMW1GOE0zK0wyN2RXaUh6dGRaOEF6ZDZuSGlycDBadFVYc3dVV0Fwa3BabEJ6WkdweTB0UWMvV0YrMzR5YXc9PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTYxODE3MzYyM30="
    }
   
    stages {
        stage('Cloning Git') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[url: 'https://github.com/sunil-paswan/Impulse.git']]])
            }
            
        }
  
    // Building Docker images
    stage('Building image') {
      steps{
        script {
          dockerImage = docker.build registry
        }
      }
    }
   
    // Uploading Docker images into AWS ECR
    stage('Pushing to ECR') {
     steps{  
         script {
                bat 'docker login -u AWS -p eyJwYXlsb2FkIjoiS3NkeGhiUUpFSmJXMjNoTDlrejJYc08yWis5WFJrMkVxc3R6eXMzdUlpczlyUW9PS0Y5NElJdGUzQnlRWC9vc2UrZmk5aXVCMk1OMWIvZmxURmJONGdJQnFzTm55MWhOS200aXpEL0x6WWt3NVhXbXBvMW1oUnp6ZEsyeEdzaXZMSEcrYU0zTEh5NXNVRmRJU2ZRNkI3WGRvVk9LVEE2d0Q0UVNhNm16ZDRsNjhDMTFMczBQMVpJbURURnJWNHdiRjc4K3hTZW40bGVxYy9Jck9OTExoL2pGVVBEY1IrczNmSGcwWnA3WHlWeVNnZyt4dG5TK3RJRFA4L3BFU0cwblJqT0FIOER4a0RqTU0rV1dxR1prMW5CRW1lMWRkRUNjUGlwVEd1cnltS1gyN0lvZlBDR01ZRnlZZUN5SkxManZrcVlrSmcwb05ac2ZRY0pkV3lmWlE1c1E4VzBhSE5IbWFOZzBMZHVLeWJiWEhoeWRidTRoNWZqWjFNajN0em8vam1iZWZ2WlhOOExPT3ZSNW4xSlhUckN0WmxGOU5EYmpyRGJPL0xRa3pXS0dhanNsVGpuZEdjMEhpbllua0loR2ZuTEQ2dzQ3bFRQWlU2cnkrY3hOTGpmWFpIeFpmUWsvRTRTTkJFOCtTRmNYc3ltV1JSR2ZWS0R6a1lNeHh5cWRIalRGTzZQWTFueWJiSXVWOUdreGlmTlIzQjRUck9aYmV4dW1lVGVRT0c3RUd3SkI3aDY3WWxkYmNwbXUzYWxwVE16TVdtSGYwV0lseWI1bnpwNW0yY3BFRExvN1hJbVlid3pWbGh0R0Z3UHJBc0tHL3hldVZNMTdwZEZJWVlVUGlXNDcra014MmZHVXo0RE9YUk9qazZhelpFSVhEWmNqaElCODc4a2FUZ2JocGVMUU9Sb1pFNi8raW1WeUE0TkZjWUJMTGQ0MnljN0txa21tRFVma09ERHlSdndiSk5oaXB6cTJncG5RTWRuN3RJdTJEdmxQQXJrMDBKcGhndFNHeW9iNTBQbHZoSGk0UVJ2WkJUU2JyZlFteGVvM1RreEQyeXU0NERHMStYUGFVRVJvcG9CREwySXArMHpnRU5USDlRRG9LYmNLYU1TVGdNbEtrUElEY3o0WlNpTk9CL1JnSzJQUVJSMlF0cEZ5elBMMUhyUzdKaE80RzA4Wkx5SGtZRXZET3JTM2RyTUV2WitRR01sR2hLNFdFUkl4WmNMVzBIMmlaM054THI1RmRlUFk0Q1hqRk1BR29NOTU4MGUxSjlBemVkOGlTSDVSMDZ4TzhCSERadk5lQzArbHoxYXp5amVBL0M3MU0rTzBvUGxJVGg1TndCU2NrSlFPQm9PSXF1N0d1L0Nuczh6R3lVUnZzb0cxZjZrclROeW92WTZHdm1aMXlMTHp5U0pRUytJVEVuZWpCeWpyMzYwaFpjM2phQ3RuMVFGazAwUzRjQzhBT1hzMjNReFFVRmNuRll3eUdBPT0iLCJkYXRha2V5IjoiQVFJQkFIaUhXYVlUblJVV0NibnorN0x2TUcrQVB2VEh6SGxCVVE5RnFFbVYyNkJkd3dIL1BXMUZSdGM0LzFVWnkvSGlFZ0piQUFBQWZqQjhCZ2txaGtpRzl3MEJCd2FnYnpCdEFnRUFNR2dHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNV20wZ2JBVGhyTzBSU1lvbUFnRVFnRHQ5bGw2VXVUNVRTNXRTTEx2MTRoZUtSYXp1cWo0UkdlQjJ4dmVIZVhoaUh6L29HYUFhZ3p2RVpkc0ZXeGs4TmVyYkZDT0JoVHVLa0NqS1FBPT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE2MTgzMzc0Njl9  891633128047.dkr.ecr.ap-south-1.amazonaws.com'
                bat 'docker push 891633128047.dkr.ecr.ap-south-1.amazonaws.com/project:latest'
               

         
        }
      }
    }
     stage ('K8S Deploy') {
        steps {
            script {
                kubernetesDeploy(
                    configs: 'deployment.yaml',
                    kubeconfigId: 'k8s',
                    enableConfigSubstitution: true
                    )           
               
            }
        }
}
}
}
